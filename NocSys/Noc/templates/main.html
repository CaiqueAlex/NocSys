{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>NocSys</title>
<link rel="icon" type="image/png" href="{% static 'css/Nocsyslogo.png' %}">
<link rel="stylesheet" href="{% static 'css/main.css' %}" />
</head>
<body>

<!-- BARRA SUPERIOR E ANIMA√á√ÉO - Vis√≠vel em todas as telas -->
<div class="top-bar fade-slide-down">
    <div class="top-bar-left">
        <button id="menu-toggle-btn" class="menu-toggle-btn" title="Alternar menu">
            <span></span>
            <span></span>
            <span></span>
        </button>
        <div class="logo-login">NocSys</div>
        {% if user.is_authenticated %}
        <div id="logo-animation-container">
            <span id="typing-text"></span><span id="blinking-cursor"></span>
            <div id="face-emoji">
                <div class="face-eye left"></div>
                <div class="face-eye right"></div>
                <div class="face-mouth"></div>
            </div>
        </div>
        {% endif %}
    </div>
    <div class="top-bar-right">
        <button id="settings-btn" title="Configura√ß√µes">‚öôÔ∏è</button>
        <div class="clock" id="clock">--:--:--</div>
        <div class="theme-switch-wrapper">
            <label class="theme-switch" for="theme-checkbox">
                <input type="checkbox" id="theme-checkbox" />
                <div class="slider round"></div>
            </label>
        </div>
    </div>
</div>
<div id="lightbulb-anim-container">
    <div id="lightbulb">üí°</div>
</div>


{% if user.is_authenticated %}
  <!-- IN√çCIO DO CONTE√öDO DA HOME (AUTENTICADO) -->
  <div id="csrf-container" style="display: none;">{% csrf_token %}</div>
  <div class="main-container" id="main-container">
      <div class="sidebar" id="sidebar">
        <div class="logo">
          <img src="{% static 'css/Nocsyslogo.png' %}" alt="NocSys Logo" class="sidebar-logo-img">
          <span>NocSys</span>
        </div>
        <ul class="menu">
          <li><a href="#" id="menu-dashboard">üè† Dashboard</a></li>
          <li><a href="#" id="menu-chamados-abertos">üü° Chamados em Aberto</a></li>
          <li><a href="#" id="menu-chamados-finalizados">üìä Chamados Finalizados</a></li>
          <li><a href="{% url 'logout' %}">üö™ Sair</a></li>
        </ul>
      </div>
      <div class="content" id="content-area">
        <!-- O conte√∫do ser√° carregado dinamicamente aqui -->
      </div>
  </div>
  <!-- FIM DO CONTE√öDO DA HOME -->

{% else %}
  <!-- IN√çCIO DO CONTE√öDO DE LOGIN (N√ÉO AUTENTICADO) -->
  <div class="login-page-container fade-zoom-in">
    <div class="login-box fade-zoom-in" id="login-box">
      <h2 class="titlelogin">NocSys - Login</h2>
      {% if error %}
        <p class="error">{{ error }}</p>
      {% endif %}
      <form method="post" action="{% url 'main' %}" id="login-form">
        {% csrf_token %}
        <input type="text" name="username" placeholder="Usu√°rio" required autocomplete="username" />
        <input type="password" name="password" placeholder="Senha" required autocomplete="current-password" />
        <button type="submit">Entrar</button>
      </form>
    </div>
  </div>
  <!-- FIM DO CONTE√öDO DE LOGIN -->
{% endif %}

<!-- Anima√ß√£o de Inatividade -->
<div id="inactive-prompt-container">
    <div class="speech-bubble">
        <p id="inactive-prompt-text"></p>
    </div>
    <div class="prompt-character">ü§î</div>
</div>

<!-- MODAL DE CONFIRMA√á√ÉO DE EXCLUS√ÉO -->
<div id="confirm-delete-backdrop" class="modal-backdrop hidden">
    <div id="confirm-delete-box" class="modal-box">
        <div id="confirm-initial-view">
            <h2 id="confirm-delete-title"></h2>
            <div class="modal-buttons">
                <button id="confirm-delete-no-btn">N√£o, mudei de ideia!</button>
                <button id="confirm-delete-yes-btn">Sim, pode apagar!</button>
            </div>
        </div>
        <div id="confirm-success-view" class="hidden">
            <p style="font-size: 1.5rem; text-align: center;">Apagado! ‚úÖ</p>
        </div>
    </div>
</div>

<!-- MODAL DE CONFIRMA√á√ÉO DE FINALIZA√á√ÉO -->
<div id="confirm-finalize-backdrop" class="modal-backdrop hidden">
    <div id="confirm-finalize-box" class="modal-box">
        <div id="confirm-initial-view-finalize">
            <h2 id="confirm-finalize-title"></h2>
            <div class="modal-buttons">
                <button id="confirm-finalize-no-btn">Cancelar</button>
                <button id="confirm-finalize-yes-btn">Sim, finalizar chamado!</button>
            </div>
        </div>
        <div id="confirm-finalize-success-view" class="hidden">
            <p style="font-size: 1.5rem; text-align: center;">Chamado Finalizado! ‚úîÔ∏è</p>
        </div>
    </div>
</div>

<!-- MODAL DE EDI√á√ÉO DE CHAMADO -->
<div id="edit-chamado-backdrop" class="modal-backdrop hidden">
    <div id="edit-chamado-box" class="modal-box">
        <button id="edit-chamado-close-btn" class="modal-close-btn">&times;</button>
        
        <div id="edit-chamado-form-view">
            <h2>Editar Chamado #<span id="edit-chamado-codigo"></span></h2>
            <form id="edit-chamado-form" class="detalhes-suporte-container" style="margin-top: 1rem; padding: 0;">
                <div class="detalhes-grid">
                    <span>Suporte:</span>
                    <div class="suporte-field-container">
                        <select name="suporte" id="suporte-select"></select>
                        <button type="button" id="assign-to-me-btn" title="Atribuir a mim">üë§</button>
                    </div>
                    <span>Cliente:</span> <input name="cliente" readonly />
                    <span>Setor:</span> <input name="setor" />
                    <span>Resumo:</span> <input name="resumo" />
                    <span>Problema:</span> <textarea name="problema" rows="3"></textarea>
                    <span>Solu√ß√£o:</span> <textarea name="solucao" rows="3"></textarea>
                    <span>Indicador:</span>
                    <select name="indicador">
                        <option value="">Selecione...</option>
                        <option value="Requisi√ß√£o">Requisi√ß√£o</option>
                        <option value="Incidente">Incidente</option>
                    </select>
                    <span>Tempo Solu√ß√£o:</span> <input name="tempo_solucao" readonly />
                </div>
                <div class="modal-buttons">
                    <button type="submit" id="edit-chamado-save-btn">Salvar Altera√ß√µes</button>
                </div>
            </form>
        </div>
        
        <div id="edit-chamado-success-view" class="hidden">
            <p style="font-size: 1.5rem; text-align: center;">Altera√ß√µes salvas! ‚úÖ</p>
        </div>
    </div>
</div>

<!-- MODAL DE CONFIGURA√á√ïES -->
<div id="settings-backdrop" class="modal-backdrop hidden">
    <div id="settings-box" class="modal-box">
        <div class="settings-container fade-in">
            <div class="settings-sidebar">
                <h3>Configura√ß√µes</h3>
                <ul>
                    <li><a href="#" class="settings-nav-link active" data-target="settings-view-user">üë§ Usu√°rio</a></li>
                    <li><a href="#" class="settings-nav-link" data-target="settings-view-export">üì§ Exportar XML</a></li>
                </ul>
            </div>
            <div class="settings-content">
                <button id="settings-close-btn" class="modal-close-btn">&times;</button>
                
                <!-- View do Usu√°rio -->
                <div id="settings-view-user" class="settings-view">
                    <h2>Detalhes do Usu√°rio</h2>
                    <div class="user-details-grid">
                        <span>Nome Completo:</span> <strong id="settings-user-name">Carregando...</strong>
                        <span>Email:</span> <strong id="settings-user-email">Carregando...</strong>
                        <span>Usu√°rio:</span> <strong id="settings-user-username">Carregando...</strong>
                        <hr>
                        <span>Membro desde:</span> <strong id="settings-user-joined">Carregando...</strong>
                        <span>Chamados Finalizados:</span> <strong id="settings-finalizados-count">Carregando...</strong>
                    </div>
                </div>

                <!-- View de Exporta√ß√£o -->
                <div id="settings-view-export" class="settings-view hidden">
                    <h2>Exportar Dados</h2>
                    <p>Funcionalidade em desenvolvimento (WIP). Em breve voc√™ poder√° exportar seus dados em formato XML.</p>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- SCRIPTS GERAIS -->
<script src="{% static 'js/dashboard.js' %}"></script>
<script src="{% static 'js/abertos.js' %}"></script>
<script src="{% static 'js/chamados_finalizados.js' %}"></script>
<script src="{% static 'js/config.js' %}"></script>

<script>
  // --- FUN√á√ÉO PARA PEGAR O CSRF TOKEN ---
  function getCsrfToken() {
    // Busca o token no container para usu√°rios logados, ou no form de login para n√£o logados.
    const csrfInput = document.querySelector('#csrf-container [name="csrfmiddlewaretoken"]') || document.querySelector('#login-form [name="csrfmiddlewaretoken"]');
    return csrfInput ? csrfInput.value : '';
  }

  // --- L√ìGICA DO MODAL DE EDI√á√ÉO (CENTRALIZADA) ---
  async function showEditModal(codigo) {
    const backdrop = document.getElementById('edit-chamado-backdrop');
    const formView = document.getElementById('edit-chamado-form-view');
    const successView = document.getElementById('edit-chamado-success-view');
    const form = document.getElementById('edit-chamado-form');
    const closeBtn = document.getElementById('edit-chamado-close-btn');
    const suporteSelect = document.getElementById('suporte-select');
    const assignBtn = document.getElementById('assign-to-me-btn');

    formView.classList.remove('hidden', 'content-hiding');
    successView.classList.add('hidden');
    backdrop.classList.remove('hidden');
    document.getElementById('edit-chamado-codigo').textContent = codigo;
    form.reset();

    const saveBtn = document.getElementById('edit-chamado-save-btn');
    saveBtn.disabled = true;
    saveBtn.textContent = 'Carregando...';

    const isFinalizadoElement = document.getElementById(`chamado-${codigo}`);
    const isFinalizado = isFinalizadoElement && isFinalizadoElement.closest('#content-area').querySelector('h1')?.textContent.includes('Finalizados');
    
    try {
        const usersRes = await fetch('/api/users/');
        if (!usersRes.ok) throw new Error('Falha ao carregar lista de usu√°rios.');
        const users = await usersRes.json();
        
        suporteSelect.innerHTML = '<option value="">Selecione...</option>';
        users.forEach(user => {
            const option = document.createElement('option');
            option.value = user;
            option.textContent = user;
            suporteSelect.appendChild(option);
        });

        const res = await fetch(`/api/whatsapp-slots/?finalizado=${isFinalizado ? 1 : 0}`);
        if (!res.ok) throw new Error('Falha ao carregar dados do chamado.');
        
        const chamados = await res.json();
        const ultimoSlot = chamados
            .filter(s => s.codigo_chamado === codigo)
            .sort((a, b) => new Date(b.criado_em) - new Date(a.criado_em))[0];

        if (ultimoSlot) {
            form.elements.suporte.value = ultimoSlot.suporte || '';
            form.elements.cliente.value = ultimoSlot.cliente || '';
            form.elements.setor.value = ultimoSlot.setor || '';
            form.elements.resumo.value = ultimoSlot.resumo || '';
            form.elements.problema.value = ultimoSlot.problema || '';
            form.elements.solucao.value = ultimoSlot.solucao || '';
            form.elements.indicador.value = ultimoSlot.indicador || '';
            form.elements.tempo_solucao.value = ultimoSlot.tempo_solucao || (isFinalizado ? 'N/A' : 'Ainda em aberto');
        }
        saveBtn.disabled = false;
        saveBtn.textContent = 'Salvar Altera√ß√µes';

    } catch (error) {
        console.error("Erro ao popular formul√°rio de edi√ß√£o:", error);
        alert(error.message);
        backdrop.classList.add('hidden');
        return;
    }

    const hide = () => { backdrop.classList.add('hidden'); };
    
    const assignToMe = async () => {
        try {
            const res = await fetch('/api/user/stats/');
            if (!res.ok) throw new Error('Falha ao obter dados do usu√°rio logado.');
            const userData = await res.json();
            suporteSelect.value = userData.username;
        } catch(error) { alert(error.message); }
    };

    const handleSave = async (event) => {
        event.preventDefault();
        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());

        saveBtn.disabled = true;
        saveBtn.textContent = 'Salvando...';

        try {
            const response = await fetch(`/api/chamado/atualizar/${codigo}/`, {
                method: 'PATCH',
                headers: { 'Content-Type': 'application/json', 'X-CSRFToken': getCsrfToken() },
                body: JSON.stringify(data),
            });
            if (!response.ok) throw new Error('Falha ao salvar as altera√ß√µes.');

            formView.classList.add('content-hiding');
            setTimeout(() => {
                formView.classList.add('hidden');
                successView.classList.remove('hidden');
                setTimeout(() => {
                    hide();
                    if (isFinalizado) { loadChamadosFinalizados(); } 
                    else { loadAbertos(); }
                }, 1200);
            }, 300);

        } catch (error) {
            console.error('Erro ao salvar:', error);
            alert(error.message);
            saveBtn.disabled = false;
            saveBtn.textContent = 'Salvar Altera√ß√µes';
        }
    };
    
    const cleanupListeners = () => {
        form.removeEventListener('submit', handleSave);
        closeBtn.removeEventListener('click', handleClose);
        assignBtn.removeEventListener('click', assignToMe);
    };
    const handleClose = () => { hide(); cleanupListeners(); };
    
    form.addEventListener('submit', handleSave);
    closeBtn.addEventListener('click', handleClose);
    assignBtn.addEventListener('click', assignToMe);
  }

  // --- L√ìGICA DOS MODAIS DE CONFIRMA√á√ÉO ---

  // Fun√ß√£o gen√©rica para anima√ß√£o de escrita
  function typeWriter(element, text, speed) {
      return new Promise((resolve) => {
          let i = 0;
          element.innerHTML = '';
          const cursor = '<span class="cursor"></span>';
          element.innerHTML = cursor;
          function type() {
              if (i < text.length) {
                  element.innerHTML = text.substring(0, i + 1) + cursor;
                  i++;
                  setTimeout(type, speed);
              } else {
                  element.innerHTML = text;
                  resolve();
              }
          }
          type();
      });
  }

  // Modal de Exclus√£o
  const deletePhrases = [
      "Tem certeza? üòï Apagar o chamado #{codigo} √© um caminho sem volta... tipo meia perdida na m√°quina de lavar.",
      "Certeza mesmo? üßê O chamado #{codigo} ser√° enviado para o v√°cuo c√≥smico, de onde nada retorna.",
      "√öltima chance! üò¨ Clicar em 'Sim' vai deletar o chamado #{codigo} mais r√°pido que um piscar de olhos.",
      "Pense bem... O hist√≥rico do chamado #{codigo} est√° prestes a virar poeira digital. Continuar?",
      "Alerta! üö® O chamado #{codigo} ser√° permanentemente exclu√≠do. N√£o temos um 'desfazer' para isso."
  ];
  function showDeleteConfirmModal(codigo) {
      const backdrop = document.getElementById('confirm-delete-backdrop');
      const title = document.getElementById('confirm-delete-title');
      const noBtn = document.getElementById('confirm-delete-no-btn');
      const yesBtn = document.getElementById('confirm-delete-yes-btn');
      
      backdrop.querySelector('#confirm-initial-view').classList.remove('hidden', 'content-hiding');
      backdrop.querySelector('#confirm-success-view').classList.add('hidden');
      backdrop.classList.remove('hidden');

      const message = deletePhrases[Math.floor(Math.random() * deletePhrases.length)].replace('{codigo}', codigo);
      typeWriter(title, message, 25);

      return new Promise(resolve => {
          const handleYesClick = () => { resolve(true); cleanup(); };
          const handleNoClick = () => { backdrop.classList.add('hidden'); resolve(false); cleanup(); };
          const cleanup = () => {
              yesBtn.removeEventListener('click', handleYesClick);
              noBtn.removeEventListener('click', handleNoClick);
          };
          yesBtn.addEventListener('click', handleYesClick, { once: true });
          noBtn.addEventListener('click', handleNoClick, { once: true });
      });
  }
  async function apagarChamado(codigo) {
      if (!(await showDeleteConfirmModal(codigo))) return;

      const backdrop = document.getElementById('confirm-delete-backdrop');
      const initialView = document.getElementById('confirm-initial-view');
      const successView = document.getElementById('confirm-success-view');
      
      initialView.classList.add('content-hiding');
      setTimeout(() => {
          initialView.classList.add('hidden');
          successView.classList.remove('hidden');
      }, 300);

      try {
          const response = await fetch(`/api/chamado/apagar/${codigo}/`, {
              method: 'DELETE',
              headers: { 'X-CSRFToken': getCsrfToken() }
          });
          if (!response.ok) {
              const errorData = await response.json();
              throw new Error(errorData.detail || 'Falha ao apagar o chamado.');
          }
          await new Promise(res => setTimeout(res, 1200));
          backdrop.classList.add('hidden');
          const chamadoElement = document.getElementById(`chamado-${codigo}`);
          if (chamadoElement) {
              chamadoElement.style.transition = 'opacity 0.5s ease';
              chamadoElement.style.opacity = '0';
              setTimeout(() => chamadoElement.remove(), 500);
          }
      } catch (error) {
          backdrop.classList.add('hidden');
          alert(`Erro: ${error.message}`);
          console.error('Erro ao apagar chamado:', error);
      }
  }

  // Modal de Finaliza√ß√£o
  const finalizePhrases = [
    "Pronto para encerrar o chamado #{codigo}? üöÄ O cliente agradece!",
    "Finalizar o chamado #{codigo}? Miss√£o (quase) cumprida. S√≥ falta seu clique.",
    "Bora dar baixa no chamado #{codigo}? ‚úîÔ∏è Mais um pra conta!",
  ];
  function showFinalizeConfirmModal(codigo) {
      const backdrop = document.getElementById('confirm-finalize-backdrop');
      const title = document.getElementById('confirm-finalize-title');
      const noBtn = document.getElementById('confirm-finalize-no-btn');
      const yesBtn = document.getElementById('confirm-finalize-yes-btn');
      
      backdrop.querySelector('#confirm-initial-view-finalize').classList.remove('hidden', 'content-hiding');
      backdrop.querySelector('#confirm-finalize-success-view').classList.add('hidden');
      backdrop.classList.remove('hidden');

      const message = finalizePhrases[Math.floor(Math.random() * finalizePhrases.length)].replace('{codigo}', codigo);
      typeWriter(title, message, 25);

      return new Promise(resolve => {
          const handleYesClick = () => { resolve(true); cleanup(); };
          const handleNoClick = () => { backdrop.classList.add('hidden'); resolve(false); cleanup(); };
          const cleanup = () => {
              yesBtn.removeEventListener('click', handleYesClick);
              noBtn.removeEventListener('click', handleNoClick);
          };
          yesBtn.addEventListener('click', handleYesClick, { once: true });
          noBtn.addEventListener('click', handleNoClick, { once: true });
      });
  }
  async function finalizarChamado(codigo) {
      if (!(await showFinalizeConfirmModal(codigo))) return;

      const backdrop = document.getElementById('confirm-finalize-backdrop');
      const initialView = document.getElementById('confirm-initial-view-finalize');
      const successView = document.getElementById('confirm-finalize-success-view');

      initialView.classList.add('content-hiding');
      setTimeout(() => {
          initialView.classList.add('hidden');
          successView.classList.remove('hidden');
      }, 300);
      
      try {
          const response = await fetch(`/api/chamado/finalizar/${codigo}/`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json', 'X-CSRFToken': getCsrfToken() },
              body: JSON.stringify({})
          });
          if (!response.ok) {
              const errorData = await response.json();
              throw new Error(errorData.detail || 'Falha ao finalizar o chamado.');
          }
          await new Promise(res => setTimeout(res, 1200));
          backdrop.classList.add('hidden');
          const chamadoElement = document.getElementById(`chamado-${codigo}`);
          if (chamadoElement) {
              chamadoElement.style.transition = 'opacity 0.5s ease, transform 0.5s ease, height 0.5s ease, margin 0.5s ease, padding 0.5s ease';
              chamadoElement.style.opacity = '0';
              chamadoElement.style.transform = 'scale(0.95)';
              chamadoElement.style.height = '0';
              chamadoElement.style.margin = '0';
              chamadoElement.style.padding = '0';
              setTimeout(() => chamadoElement.remove(), 500);
          }
      } catch (error) {
          backdrop.classList.add('hidden');
          alert(`Erro: ${error.message}`);
          console.error('Erro ao finalizar chamado:', error);
      }
  }


  // Scripts da Home Autenticada
  if (document.getElementById("menu-chamados-abertos")) {
    document.getElementById("menu-dashboard").addEventListener("click", e => { e.preventDefault(); loadDashboard(); });
    document.getElementById("menu-chamados-abertos").addEventListener("click", e => { e.preventDefault(); loadAbertos(); });
    document.getElementById("menu-chamados-finalizados").addEventListener("click", e => { e.preventDefault(); loadChamadosFinalizados(); });
  }

  // Script do Login
  const form = document.getElementById('login-form');
  if (form) {
    form.addEventListener('submit', function (e) {
      e.preventDefault(); document.body.classList.add('fade-zoom-out'); setTimeout(() => form.submit(), 400);
    });
  }

  // Scripts da Barra Superior e Sidebar
  document.addEventListener('DOMContentLoaded', () => {
    if (document.querySelector('.main-container')) { loadDashboard(); }
    const clockElement = document.getElementById('clock');
    function updateClock() {
      if (clockElement) {
        const now = new Date();
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        clockElement.textContent = `${hours}:${minutes}:${seconds}`;
      }
    }
    setInterval(updateClock, 1000); updateClock();
    const themeToggle = document.getElementById('theme-checkbox');
    const body = document.body;
    const lightbulb = document.getElementById('lightbulb');
    const currentTheme = localStorage.getItem('theme');
    function applyTheme(theme) {
        if (theme === 'light') { body.classList.add('light-mode'); if(themeToggle) themeToggle.checked = true; } 
        else { body.classList.remove('light-mode'); if(themeToggle) themeToggle.checked = false; }
    }
    if (currentTheme) { applyTheme(currentTheme); }
    function animateBulb(mode) {
        if (!lightbulb) return;
        lightbulb.className = ''; void lightbulb.offsetWidth;
        if (mode === 'light') { lightbulb.classList.add('animate-on'); } 
        else { lightbulb.classList.add('animate-off'); }
    }
    if (themeToggle) {
        themeToggle.addEventListener('change', () => {
            let newTheme = themeToggle.checked ? 'light' : 'dark';
            animateBulb(newTheme);
            setTimeout(() => { applyTheme(newTheme); localStorage.setItem('theme', newTheme); }, 1000);
        });
    }
    const menuToggleBtn = document.getElementById('menu-toggle-btn');
    const sidebar = document.getElementById('sidebar');
    const mainContainer = document.getElementById('main-container');
    if (menuToggleBtn && sidebar && mainContainer) {
        let hoverTimeout;
        menuToggleBtn.addEventListener('click', () => { sidebar.classList.toggle('sidebar-pinned'); mainContainer.classList.toggle('content-shifted'); });
        const showSidebarOnHover = () => { clearTimeout(hoverTimeout); if (!sidebar.classList.contains('sidebar-pinned')) { sidebar.classList.add('sidebar-visible'); mainContainer.classList.add('content-shifted'); } };
        const hideSidebarOnLeave = () => { hoverTimeout = setTimeout(() => { if (!sidebar.classList.contains('sidebar-pinned')) { sidebar.classList.remove('sidebar-visible'); mainContainer.classList.remove('content-shifted'); } }, 300); };
        menuToggleBtn.addEventListener('mouseenter', showSidebarOnHover);
        sidebar.addEventListener('mouseenter', showSidebarOnHover);
        menuToggleBtn.addEventListener('mouseleave', hideSidebarOnLeave);
        sidebar.addEventListener('mouseleave', hideSidebarOnLeave);
    }
    const animationContainer = document.getElementById('logo-animation-container');
    if (animationContainer) {
        const typingText = document.getElementById('typing-text');
        const face = document.getElementById('face-emoji');
        const fullText = "Network Operation Center System"; 
        let isAnimating = false;
        const runAnimationCycle = async () => {
            if (isAnimating) return;
            isAnimating = true;
            animationContainer.style.width = 'auto'; typingText.textContent = '';
            for (let i = 0; i < fullText.length; i++) { typingText.textContent += fullText[i]; await new Promise(res => setTimeout(res, 80)); }
            face.classList.add('animate-face');
            await new Promise(res => setTimeout(res, 5000));
            face.classList.remove('animate-face');
            for (let i = fullText.length; i >= 0; i--) { face.style.transform = `translateX(${(1 - i / fullText.length) * 100}%)`; typingText.textContent = fullText.substring(0, i); await new Promise(res => setTimeout(res, 40)); }
            animationContainer.style.width = '0'; isAnimating = false;
        };
        setInterval(runAnimationCycle, 60000);
    }
    const promptContainer = document.getElementById('inactive-prompt-container');
    if (promptContainer) {
        const promptText = document.getElementById('inactive-prompt-text');
        const phrases = ["Ainda est√° a√≠?", "O que acha de se mexer um pouco?", "Um caf√© cairia bem agora...", "Ei, psiu!", "Tudo certo por aqui?", "Sil√™ncio total... ser√° que dormiu no teclado?", "O tempo parou ou foi voc√™ que congelou?", "Se fosse um jogo, j√° tinha aparecido a tela de pausa üò¥", "A cadeira est√° com saudade de voc√™.", "A energia caiu a√≠ ou s√≥ a motiva√ß√£o?", "Se ainda estiver por a√≠, pisque duas vezes!", "A tela sente sua falta. Volta logo!", "Essa pausa virou medita√ß√£o?", "A produtividade foi tomar √°gua, voc√™ vai junto?", "Vamos fingir que isso foi uma pausa estrat√©gica.", "Tem algu√©m a√≠ ou s√≥ os ecos da √∫ltima a√ß√£o?", "Esse sil√™ncio me lembra quando o Wi-Fi cai...", "Aten√ß√£o: suspeita de modo fantasma ativado.", "O universo est√° esperando sua pr√≥xima jogada.", "Enquanto voc√™ pensa, os pixels tiram uma soneca.", "Parece que o teclado entrou em f√©rias coletivas.", "Se tivesse um pr√™mio por ficar parado... voc√™ ganhava!", "Ei, voltou? Ah n√£o, foi s√≥ o vento.", "Nem uma piscadinha? Estou come√ßando a me preocupar.", "A pausa t√° t√£o longa que virou feriado.", "O sistema detectou... saudades suas.", "Quase chamei os bombeiros, achei que voc√™ tinha evaporado.", "Nem parece que algu√©m estava digitando aqui h√° pouco.", "A atividade sumiu mais r√°pido que as segundas-feiras felizes.", "N√£o quero ser chato, mas... voc√™ esqueceu de mim?", "Ser√° que eu falo sozinho ou voc√™ est√° s√≥ disfar√ßando?", "Se for suspense, j√° ganhou minha aten√ß√£o!", "Modo ‚Äòest√°tua‚Äô ativado com sucesso.", "S√≥ confirmando: voc√™ virou poeira c√≥smica ou foi s√≥ um cochilo?", "T√° tudo bem a√≠? At√© a barra de progresso se desesperou!", "Al√¥? Terra chamando...", "O sistema est√° ocioso. Hora de um alongamento!", "At√© os servidores est√£o mais ativos que voc√™.", "Isso √© uma pausa para o caf√© ou uma hiberna√ß√£o?", "Detectei um v√°cuo de atividade no seu setor."];
        let inactivityTimer;
        let promptIsVisible = false;
        const INACTIVITY_TIME = 120000; 
        const showPrompt = () => {
            if (promptIsVisible) return;
            promptIsVisible = true;
            promptText.textContent = phrases[Math.floor(Math.random() * phrases.length)];
            promptContainer.classList.remove('hiding');
            promptContainer.classList.add('visible');
        };
        const hidePrompt = () => {
            if (!promptIsVisible) return;
            promptIsVisible = false;
            promptContainer.classList.add('hiding');
            setTimeout(() => { promptContainer.classList.remove('visible'); }, 500); 
        };
        const resetInactivityTimer = () => {
            hidePrompt();
            clearTimeout(inactivityTimer);
            inactivityTimer = setTimeout(showPrompt, INACTIVITY_TIME);
        };
        window.addEventListener('mousedown', resetInactivityTimer);
        resetInactivityTimer();
    }
    const settingsBtn = document.getElementById('settings-btn');
    if(settingsBtn) { settingsBtn.addEventListener('click', showSettingsModal); }
  });
</script>

</body>
</html>